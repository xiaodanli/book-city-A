require(["jquery","storage","getRequest","jsonp","base64","render"],function(n,e,t,a,c,i){var o=n(".set-wrap"),s=e.get("chapter_id")||1;n(".cur-chapter").html(s);var l=t().fiction_id,r=e.get("already")||[];function d(){n.ajax({url:"/api/artical",data:{fiction_id:l,chapter_id:s},dataType:"json",success:function(t){console.log(t),a({url:t.jsonp,callback:"duokan_fiction_chapter",cache:!0,success:function(t){var a=n.base64.atob(t,!0),c=JSON.parse(a);console.log(c),i("#artical-tpl",".artical-con",c,!0),-1==r.indexOf(s)&&(r.push(s),e.set("already",r))}})},error:function(t){console.warn(t)}})}e.get("code")?d():location.href="../../page/login.html",n(".set-t").on("click","span",function(){location.href="../../page/detail.html?fiction_id="+l}),n("#next-btn").on("click",function(){s<4?(s+=1,d(),n(".cur-chapter").html(s),e.set("chapter_id",s)):alert("最后一章")}),n("#pre-btn").on("click",function(){1<s?(s-=1,d(),n(".cur-chapter").html(s),e.set("chapter_id",s)):alert("没有上一章")}),n.ajax({url:"/api/chapter",data:{fiction_id:l},dataType:"json",success:function(t){console.log(t),n(".total-chapter").html(t.item.toc.length)},error:function(t){console.warn(t)}}),n(".chapter-btn").on("click",function(){location.href="../../page/chapter-list.html?fiction_id="+l+"&chapter_id="+s}),n(".artical-con").on("click",function(){o.show()}),n(".mask").on("click",function(){o.hide(),n(".set-panel").hide(),n(".font-btn").removeClass("active")}),n(".font-btn").on("click",function(){n(".set-panel").toggle(),n(this).toggleClass("active")});var f=e.get("fz")||14;n(".artical-con p").css("font-size",f/37.5+"rem"),n(".large-btn").on("click",function(){f<30&&(f+=2),n(".artical-con p").css("font-size",f/37.5+"rem"),e.set("fz",f)}),n(".small-btn").on("click",function(){10<f&&(f-=2),n(".artical-con p").css("font-size",f/37.5+"rem"),e.set("fz",f)});var g=!0,h=e.get("bg")||"#f7eee5";function u(){n(".day-btn").removeClass("light"),n(".day-btn").find("dd").html("夜间"),n(".artical-con").css("background-color",h),n(".bg-btns li").each(function(){n(this).attr("data-bg")===h&&n(this).addClass("active").siblings().removeClass("active")})}function b(){n(".day-btn").addClass("light"),n(".day-btn").find("dd").html("白天"),n(".artical-con").css("background-color","#0f1410"),n(".bg-btns li:last").addClass("active").siblings().removeClass("active")}e.get("tag")&&"夜间"!==e.get("tag")?(g=!1,b()):(g=!0,u()),n(".bg-btns").on("click","li",function(){h=n(this).attr("data-bg"),n(this).addClass("active").siblings().removeClass("active"),g&&n(".artical-con").css("background-color",h),e.set("bg",h)}),n(".day-btn").on("click",function(){var t=(g=!g)?"夜间":"白天";e.set("tag",t),g?(u(),e.set("bg",h)):b()})});